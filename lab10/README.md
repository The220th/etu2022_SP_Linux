# Компиляция и запуск

``` bash
pass
```

# Некоторые уточнения

Читатели не читают, пока есть писатели, которые хотят записать в файл или который пишет прямо сейчас.

Читатели несколько раз пишут за жизнь, а читатели считывают, как только появится возможность, весь сразу файл сразу и притом лишь 1 раз.

Писатели имеют приоритет на читателями в том смысле, что если одновременно писатели и читатель хотят провзаимодействовать с файлом, читатеть будет ждать, пока не кончатся желающие писать писатели. 

В конце нужно не забыть уничтожить семафоры, а для этого нужно разобраться, кто из всех читателей и писателей будет выходить последним. Самый последний и уничтожает семафоры. 



Все операции `sops` в `semop(...)` одновремеено выполняются только для одного потока. Для этого потока полная монополия к этим семафорам, пока для остальных в очереди любые действия с этими семафорами запрещены. То есть не будет гонки.

Если очередная операция в множественном семафоре (из `sops` в `semop(...)`) не выполнилась, то ОС откатывает все операции начиная этой невыполненной из `sops` и до самой нулевой, потом ставит поток в очередь ожидания. Когда приходит очередь этого потока, то операции пытаются опять выполниться до первой неудавшейся или полностью.

В структуре `struct sembuf` во `sem_flg` флаги обозначают: 

- `SEM_UNDO` - пометить для ОС, что в случает вылета программы (или её насильного прерывания) нужно откатить эту операцию.

- `IPC_NOWAIT` - после неудачного завершения этой операции не нужно переводить текущий поток в очередь ожидания, а просто выйти из функции с ошибкой. 
